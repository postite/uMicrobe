<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ da28365)
 * Haxe source file: /usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx
 */

namespace tink\core\_Signal;

use \tink\core\SignalObject;
use \php\_Boot\HxClosure;
use \tink\core\FutureTrigger;
use \tink\core\_Callback\SimpleLink;
use \tink\core\SignalTrigger;
use \php\Boot;
use \tink\core\_Future\FutureObject;
use \tink\core\_Callback\Callback_Impl_;
use \tink\core\Noise;
use \tink\core\_Callback\LinkPair;
use \tink\core\_Callback\CallbackList_Impl_;

final class Signal_Impl_ {
	/**
	 * @param \Closure $f
	 * 
	 * @return SignalObject
	 */
	static public function _new ($f) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:9: character 17
		$this1 = new SimpleSignal($f);
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:9: character 17
		return $this1;
	}


	/**
	 *  Creates a new signal whose values will only be emitted when the filter function evalutes to `true`
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function filter ($this1, $f, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:36: lines 36-41
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:36: lines 36-41
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:37: characters 15-111
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:37: characters 40-110
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:37: characters 77-109
				if ($f($result)) {
					#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:37: characters 92-109
					Callback_Impl_::invoke($cb, $result);
				}
			});
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:37: characters 5-112
		$ret = $this2;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:39: lines 39-40
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:39: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:40: characters 12-15
			return $ret;
		}
	}


	/**
	 *  Creates a new signal by applying a transform function to the result.
	 *  Different from `map`, the transform function of `flatMap` returns a `Future`
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function flatMap ($this1, $f, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:26: lines 26-31
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:26: lines 26-31
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:27: characters 15-99
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:27: characters 40-98
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:27: characters 77-97
				$f($result)->handle($cb);
			});
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:27: characters 5-100
		$ret = $this2;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:29: lines 29-30
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:29: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:30: characters 12-15
			return $ret;
		}
	}


	/**
	 *  Creates a new signal which stores the result internally.
	 *  Useful for tranformed futures, such as product of `map` and `flatMap`,
	 *  so that the transformation function will not be invoked for every callback
	 * 
	 * @param SignalObject $this
	 * 
	 * @return SignalObject
	 */
	static public function gather ($this1) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:105: characters 5-25
		$ret = Signal_Impl_::trigger();
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:106: characters 5-45
		$this1->handle(function ($x)  use (&$ret) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:106: characters 30-44
			CallbackList_Impl_::invoke($ret->handlers, $x);
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:107: characters 5-26
		return $ret;
	}


	/**
	 * @param \Closure $generator
	 * 
	 * @return SignalObject
	 */
	static public function generate ($generator) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:111: characters 5-25
		$ret = Signal_Impl_::trigger();
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:112: characters 5-27
		$generator(new HxClosure($ret, 'trigger'));
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:113: characters 5-15
		return $ret;
	}


	/**
	 *  Creates a new signal by joining `this` and `other`,
	 *  the new signal will be triggered whenever either of the two triggers
	 * 
	 * @param SignalObject $this
	 * @param SignalObject $other
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function join ($this1, $other, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:57: lines 57-65
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:57: lines 57-65
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:58: lines 58-61
		$this2 = new SimpleSignal(function ($cb)  use (&$other, &$this1) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:60: characters 16-50
			$a = $this1->handle($cb);
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:60: characters 16-50
			return new LinkPair($a, $other->handle($cb));
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:58: lines 58-61
		$ret = $this2;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:63: lines 63-64
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:63: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:64: characters 12-15
			return $ret;
		}
	}


	/**
	 *  Creates a new signal by applying a transform function to the result.
	 *  Different from `flatMap`, the transform function of `map` returns a sync value
	 * 
	 * @param SignalObject $this
	 * @param \Closure $f
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function map ($this1, $f, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:15: lines 15-20
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:15: lines 15-20
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:16: characters 15-99
		$this2 = new SimpleSignal(function ($cb)  use (&$f, &$this1) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:16: characters 40-98
			return $this1->handle(function ($result)  use (&$f, &$cb) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:16: characters 87-96
				$this3 = $f($result);
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:16: characters 77-97
				Callback_Impl_::invoke($cb, $this3);
			});
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:16: characters 5-100
		$ret = $this2;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:18: lines 18-19
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:18: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:19: characters 12-15
			return $ret;
		}
	}


	/**
	 * Soon to be deprecated in favor of nextTime.
	 * 
	 * @param SignalObject $this
	 * @param \Closure $condition
	 * 
	 * @return FutureObject
	 */
	static public function next ($this1, $condition = null) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:91: characters 5-31
		return Signal_Impl_::nextTime($this1, $condition);
	}


	/**
	 *  Gets the next emitted value as a Future
	 * 
	 * @param SignalObject $this
	 * @param \Closure $condition
	 * 
	 * @return FutureObject
	 */
	static public function nextTime ($this1, $condition = null) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:71: characters 5-32
		$ret = new FutureTrigger();
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:72: lines 72-73
		$link = null;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:72: lines 72-73
		$immediate = false;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:75: lines 75-79
		$link = $this1->handle(function ($v)  use (&$immediate, &$condition, &$link, &$ret) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:75: lines 75-79
			if (($condition === null) || $condition($v)) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:76: characters 7-21
				$ret->trigger($v);
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:77: lines 77-78
				if ($link === null) {
					#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:77: characters 25-41
					$immediate = true;
				} else if ($link !== null) {
					#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:78: characters 12-27
					$link->dissolve();
				}
			}
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:81: lines 81-82
		if ($immediate) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:82: characters 7-22
			if ($link !== null) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:82: characters 7-22
				$link->dissolve();
			}
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:84: characters 5-26
		return $ret;
	}


	/**
	 *  Transfroms this signal and makes it emit `Noise`
	 * 
	 * @param SignalObject $this
	 * 
	 * @return SignalObject
	 */
	static public function noise ($this1) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:97: characters 5-42
		return Signal_Impl_::map($this1, function ($_) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:97: characters 29-41
			return Noise::Noise();
		});
	}


	/**
	 *  Creates a `Signal` from classic signals that has the semantics of `addListener` and `removeListener`
	 *  Example: `var signal = Signal.ofClassical(emitter.addListener.bind(eventType), emitter.removeListener.bind(eventType));`
	 * 
	 * @param \Closure $add
	 * @param \Closure $remove
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function ofClassical ($add, $remove, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:126: lines 126-136
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:126: lines 126-136
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:127: lines 127-131
		$this1 = new SimpleSignal(function ($cb)  use (&$remove, &$add) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:128: characters 7-41
			$f = function ($a)  use (&$cb) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:128: characters 28-40
				Callback_Impl_::invoke($cb, $a);
			};
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:129: characters 7-13
			$add($f);
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:130: characters 14-25
			$f1 = $remove;
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:130: characters 14-25
			$a1 = $f;
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:130: characters 7-28
			$this2 = new SimpleLink(function ()  use (&$f1, &$a1) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:130: characters 14-25
				$f1($a1);
			});
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:130: characters 7-28
			return $this2;
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:127: lines 127-131
		$ret = $this1;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:134: lines 134-135
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:134: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:135: characters 12-15
			return $ret;
		}
	}


	/**
	 * @param SignalObject $this
	 * @param \Closure $selector
	 * @param bool $gather
	 * 
	 * @return SignalObject
	 */
	static public function select ($this1, $selector, $gather = true) {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:43: lines 43-51
		if ($gather === null) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:43: lines 43-51
			$gather = true;
		}
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:44: lines 44-47
		$this2 = new SimpleSignal(function ($cb)  use (&$selector, &$this1) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:44: lines 44-47
			return $this1->handle(function ($result)  use (&$selector, &$cb) {
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:44: characters 84-100
				$_g = $selector($result);
				#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:44: characters 84-100
				switch ($_g->index) {
					case 0:
						#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:45: characters 17-18
						$v = $_g->params[0];
						#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:45: characters 21-33
						Callback_Impl_::invoke($cb, $v);
						break;
					case 1:
												break;
				}
			});
		});
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:44: lines 44-47
		$ret = $this2;
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:49: lines 49-50
		if ($gather) {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:49: characters 19-31
			return Signal_Impl_::gather($ret);
		} else {
			#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:50: characters 12-15
			return $ret;
		}
	}


	/**
	 *  Creates a new `SignalTrigger`
	 * 
	 * @return SignalTrigger
	 */
	static public function trigger () {
		#/usr/local/lib/haxe/lib/tink_core/1,17,0/src/tink/core/Signal.hx:120: characters 5-31
		return new SignalTrigger();
	}
}


Boot::registerClass(Signal_Impl_::class, 'tink.core._Signal.Signal_Impl_');
