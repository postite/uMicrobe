<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ da28365)
 * Haxe source file: /usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx
 */

namespace tink\streams\_Stream;

use \tink\core\Outcome;
use \php\Boot;
use \tink\core\_Future\FutureObject;
use \tink\streams\StreamBase;
use \tink\core\_Future\Future_Impl_;

class FutureStream extends StreamBase {
	/**
	 * @var FutureObject
	 */
	public $target;


	/**
	 * @param FutureObject $target
	 * 
	 * @return void
	 */
	public function __construct ($target) {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:64: characters 5-25
		$this->target = $target;
	}


	/**
	 * @param \Closure $item
	 * 
	 * @return FutureObject
	 */
	public function forEach ($item) {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:76: characters 5-54
		return $this->later(function ($s)  use (&$item) {
			#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:76: characters 31-53
			return $s->forEach($item);
		});
	}


	/**
	 * @param \Closure $item
	 * 
	 * @return FutureObject
	 */
	public function forEachAsync ($item) {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:79: characters 5-59
		return $this->later(function ($s)  use (&$item) {
			#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:79: characters 31-58
			return $s->forEachAsync($item);
		});
	}


	/**
	 * @param \Closure $f
	 * 
	 * @return FutureObject
	 */
	public function later ($f) {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:66: lines 66-73
		$_gthis = $this;
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:67: lines 67-73
		return Future_Impl_::async(function ($cb)  use (&$f, &$_gthis) {
			#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:69: lines 69-72
			$_gthis->target->handle(function ($o)  use (&$f, &$cb) {
				#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:69: lines 69-72
				switch ($o->index) {
					case 0:
						#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:71: characters 24-25
						$s = $o->params[0];
						#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:71: characters 28-43
						$f($s)->handle($cb);
						break;
					case 1:
						#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:70: characters 24-25
						$e = $o->params[0];
						#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:70: characters 28-42
						$cb(Outcome::Failure($e));
						break;
				}
			});
		});
	}
}


Boot::registerClass(FutureStream::class, 'tink.streams._Stream.FutureStream');
