<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ da28365)
 * Haxe source file: /usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx
 */

namespace tink\streams;

use \php\_Boot\HxClosure;
use \tink\core\FutureTrigger;
use \php\Boot;
use \tink\core\_Future\FutureObject;
use \tink\core\_Callback\Callback_Impl_;

class Generator extends StepWise {
	/**
	 * @var \Closure
	 */
	public $step;
	/**
	 * @var \Array_hx
	 */
	public $waiting;


	/**
	 * @param \Closure $step
	 * 
	 * @return void
	 */
	public function __construct ($step) {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:104: characters 5-21
		$this->step = $step;
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:105: characters 5-61
		$this->waiting = new \Array_hx();
	}


	/**
	 * @return FutureObject
	 */
	public function next () {
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:108: lines 108-117
		$_gthis = $this;
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:109: characters 5-32
		$ret = new FutureTrigger();
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:111: characters 9-26
		$_this = $this->waiting;
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:111: characters 9-26
		$_this->arr[$_this->length] = $ret;
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:111: lines 111-114
		if (++$_this->length === 1) {
			#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:112: characters 7-33
			($this->step)()->handle(new HxClosure($ret, 'trigger'));
		} else {
			#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:114: characters 7-92
			($this->waiting->arr[$this->waiting->length - 2] ?? null)->handle(Callback_Impl_::fromNiladic(function ()  use (&$_gthis, &$ret) {
				#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:114: characters 65-91
				($_gthis->step)()->handle(new HxClosure($ret, 'trigger'));
			}));
		}
		#/usr/local/lib/haxe/lib/tink_streams/0,2,1/src/tink/streams/Stream.hx:116: characters 5-15
		return $ret;
	}
}


Boot::registerClass(Generator::class, 'tink.streams.Generator');
