<?php

// Generated by Haxe 3.4.7
class ufront_web_ErrorPageHandler implements ufront_app_UFErrorHandler{
	public function __construct() {
		if(!isset($this->renderErrorContent)) $this->renderErrorContent = array(new _hx_lambda(array(&$this), "ufront_web_ErrorPageHandler_0"), 'execute');
		if(!isset($this->renderErrorPage)) $this->renderErrorPage = array(new _hx_lambda(array(&$this), "ufront_web_ErrorPageHandler_1"), 'execute');
		if(!php_Boot::$skip_constructor) {
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::new");
		$__hx__spos = $GLOBALS['%s']->length;
		$this->showStack = true;
		$this->catchErrors = true;
		$GLOBALS['%s']->pop();
	}}
	public $catchErrors;
	public $showStack;
	public function handleError($httpError, $ctx) {
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::handleError");
		$__hx__spos = $GLOBALS['%s']->length;
		$inner = null;
		$inner1 = null;
		if($httpError !== null) {
			$inner1 = _hx_field($httpError, "data") !== null;
		} else {
			$inner1 = false;
		}
		if($inner1) {
			$inner = " (" . Std::string($httpError->data) . ")";
		} else {
			$inner = "";
		}
		$callStack = null;
		if($this->showStack) {
			$callStack = " " . _hx_string_or_null(haxe_CallStack::toString(haxe_CallStack::exceptionStack()));
		} else {
			$callStack = "";
		}
		{
			$msg = "Handling error: " . Std::string($httpError) . _hx_string_or_null($inner) . _hx_string_or_null($callStack);
			$ctx->messages->push(_hx_anonymous(array("msg" => $msg, "pos" => _hx_anonymous(array("fileName" => "ErrorPageHandler.hx", "lineNumber" => 44, "className" => "ufront.web.ErrorPageHandler", "methodName" => "handleError")), "type" => ufront_log_MessageType::$MError)));
		}
		if(($ctx->completion & 1 << ufront_web_context_RequestCompletion::$CRequestHandlersComplete->index) === 0) {
			$ctx->response->clear();
			$ctx->response->status = $httpError->code;
			$ctx->response->set_contentType("text/html");
			$ctx1 = $ctx->response;
			$ctx1->write($this->renderError($httpError, $this->showStack));
			$ctx2 = $ctx;
			$ctx2->completion = $ctx2->completion | 1 << ufront_web_context_RequestCompletion::$CRequestHandlersComplete->index;
		}
		if(!$this->catchErrors) {
			$httpError->throwSelf();
		}
		{
			$tmp = ufront_core_SurpriseTools::success();
			$GLOBALS['%s']->pop();
			return $tmp;
		}
		$GLOBALS['%s']->pop();
	}
	public function renderErrorContent($error, $showStack = null) { return call_user_func_array($this->renderErrorContent, array($error, $showStack)); }
	public $renderErrorContent = null;
	public function renderErrorPage($title, $content) { return call_user_func_array($this->renderErrorPage, array($title, $content)); }
	public $renderErrorPage = null;
	public function renderError($error, $showStack = null) {
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::renderError");
		$__hx__spos = $GLOBALS['%s']->length;
		$content = $this->renderErrorContent($error, $showStack);
		{
			$tmp = $this->renderErrorPage($error->message, $content);
			$GLOBALS['%s']->pop();
			return $tmp;
		}
		$GLOBALS['%s']->pop();
	}
	public function __call($m, $a) {
		if(isset($this->$m) && is_callable($this->$m))
			return call_user_func_array($this->$m, $a);
		else if(isset($this->__dynamics[$m]) && is_callable($this->__dynamics[$m]))
			return call_user_func_array($this->__dynamics[$m], $a);
		else if('toString' == $m)
			return $this->__toString();
		else
			throw new HException('Unable to call <'.$m.'>');
	}
	static function errorStackItems($stack) {
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::errorStackItems");
		$__hx__spos = $GLOBALS['%s']->length;
		$stack->pop();
		$stack = $stack->slice(2, null);
		$arr = _hx_explode("\x0A", haxe_CallStack::toString($stack));
		{
			$GLOBALS['%s']->pop();
			return $arr;
		}
		$GLOBALS['%s']->pop();
	}
	function __toString() { return 'ufront.web.ErrorPageHandler'; }
}
function ufront_web_ErrorPageHandler_0(&$__hx__this, $error, $showStack) {
	{
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::new");
		$__hx__spos = $GLOBALS['%s']->length;
		if($showStack === null) {
			$showStack = false;
		}
		$inner = null;
		if(null !== _hx_field($error, "data")) {
			$inner = "<p class=\"error-data\">" . Std::string($error->data) . "</p>";
		} else {
			$inner = "";
		}
		$pos = null;
		if($showStack) {
			$pos = "<p class=\"error-pos\">&gt; " . _hx_string_or_null($error->printPos()) . "</p>";
		} else {
			$pos = "";
		}
		$exceptionStackItems = ufront_web_ErrorPageHandler::errorStackItems(haxe_CallStack::exceptionStack());
		$exceptionStack = null;
		$exceptionStack1 = null;
		if($showStack) {
			$exceptionStack1 = $exceptionStackItems->length > 0;
		} else {
			$exceptionStack1 = false;
		}
		if($exceptionStack1) {
			$exceptionStack = "<div class=\"error-exception-stack\"><h3>Exception Stack:</h3>\x0A\x09\x09\x09\x09\x09<pre><code>" . _hx_string_or_null($exceptionStackItems->join("\x0A")) . "</pre></code>\x0A\x09\x09\x09\x09</div>";
		} else {
			$exceptionStack = "";
		}
		$content = "\x0A\x09\x09\x09<summary class=\"error-summary\"><h1 class=\"error-message\">" . _hx_string_or_null($error->message) . "</h1></summary>\x0A\x09\x09\x09<details class=\"error-details\"> " . _hx_string_or_null($inner) . " " . _hx_string_or_null($pos) . " " . _hx_string_or_null($exceptionStack) . "</details>\x0A\x09\x09";
		{
			$GLOBALS['%s']->pop();
			return $content;
		}
		$GLOBALS['%s']->pop();
	}
}
function ufront_web_ErrorPageHandler_1(&$__hx__this, $title, $content) {
	{
		$GLOBALS['%s']->push("ufront.web.ErrorPageHandler::new");
		$__hx__spos = $GLOBALS['%s']->length;
		{
			$tmp = "<!DOCTYPE html>\x0A<html>\x0A<head>\x0A\x09<title>" . _hx_string_or_null($title) . "</title>\x0A\x09<style>\x0A\x09\x09body {\x0A\x09\x09\x09font-family: sans-serif;\x0A\x09\x09}\x0A\x09\x09.container {\x0A\x09\x09\x09max-width: 800px;\x0A\x09\x09\x09margin: 30px auto;\x0A\x09\x09}\x0A\x09\x09.jumbotron {\x0A\x09\x09\x09padding: 30px;\x0A\x09\x09\x09border-radius: 30px;\x0A\x09\x09\x09background-color: rgb(230,230,230);\x0A\x09\x09}\x0A\x09\x09p[frown] {\x0A\x09\x09\x09text-align: center;\x0A\x09\x09}\x0A\x09\x09p[frown] span { \x0A\x09\x09\x09transform: rotate(90deg);\x0A\x09\x09\x09display: inline-block;\x0A\x09\x09\x09color: #bbb;\x0A\x09\x09\x09font-size: 3em;\x0A\x09\x09}\x0A\x09</style>\x0A</head>\x0A<body>\x0A\x09<div class=\"container\">\x0A\x09\x09<div class=\"jumbotron\">\x0A\x09\x09\x09<p frown><span>:(</span></p>\x0A\x09\x09\x09" . _hx_string_or_null($content) . "\x0A\x09\x09</div>\x0A\x09</div>\x0A</body>\x0A</html>\x0A";
			$GLOBALS['%s']->pop();
			return $tmp;
		}
		$GLOBALS['%s']->pop();
	}
}
