<?php

// Generated by Haxe 3.4.7
class ufront_log_ServerConsoleLogger implements ufront_app_UFLogHandler{
	public function __construct() { if(!php_Boot::$skip_constructor) {
		$GLOBALS['%s']->push("ufront.log.ServerConsoleLogger::new");
		$__hx__spos = $GLOBALS['%s']->length;
		$GLOBALS['%s']->pop();
	}}
	public function log($ctx, $appMessages) {
		$GLOBALS['%s']->push("ufront.log.ServerConsoleLogger::log");
		$__hx__spos = $GLOBALS['%s']->length;
		$messages = (new _hx_array(array()));
		$userDetails = $ctx->request->get_clientIP();
		try {
			$tmp = null;
			if(null !== $ctx->session) {
				$tmp = $ctx->session->get_id();
			} else {
				$tmp = null;
			}
			if($tmp !== null) {
				$userDetails1 = null;
				if(null !== $ctx->session) {
					$userDetails1 = $ctx->session->get_id();
				} else {
					$userDetails1 = null;
				}
				$userDetails = _hx_string_or_null($userDetails) . _hx_string_or_null((" " . _hx_string_or_null($userDetails1)));
			}
			$tmp1 = null;
			$tmp2 = null;
			if($ctx->auth !== null) {
				$tmp2 = $ctx->auth->get_currentUser() !== null;
			} else {
				$tmp2 = false;
			}
			if($tmp2) {
				$tmp1 = $ctx->auth->get_currentUser()->get_userID();
			} else {
				$tmp1 = null;
			}
			if($tmp1 !== null) {
				$userDetails2 = null;
				$userDetails3 = null;
				if($ctx->auth !== null) {
					$userDetails3 = $ctx->auth->get_currentUser() !== null;
				} else {
					$userDetails3 = false;
				}
				if($userDetails3) {
					$userDetails2 = $ctx->auth->get_currentUser()->get_userID();
				} else {
					$userDetails2 = null;
				}
				$userDetails = _hx_string_or_null($userDetails) . _hx_string_or_null((" " . _hx_string_or_null($userDetails2)));
			}
		}catch(Exception $__hx__e) {
			$_ex_ = ($__hx__e instanceof HException) && $__hx__e->getCode() == null ? $__hx__e->e : $__hx__e;
			$e = $_ex_;
			{
				$GLOBALS['%e'] = (new _hx_array(array()));
				while($GLOBALS['%s']->length >= $__hx__spos) {
					$GLOBALS['%e']->unshift($GLOBALS['%s']->pop());
				}
				$GLOBALS['%s']->push($GLOBALS['%e'][0]);
			}
		}
		$requestLog = "[" . _hx_string_or_null($ctx->request->get_httpMethod()) . " ";
		$requestLog1 = _hx_string_or_null($requestLog) . _hx_string_or_null($ctx->request->get_uri()) . "] from [" . _hx_string_or_null($userDetails) . "], response: [";
		$requestLog2 = _hx_string_or_null($requestLog1) . _hx_string_rec($ctx->response->status, "") . " ";
		$requestLog3 = _hx_string_or_null($requestLog2) . _hx_string_or_null($ctx->response->get_contentType()) . "]";
		$messages->push($requestLog3);
		{
			$_g = 0;
			$_g1 = $ctx->messages;
			while($_g < $_g1->length) {
				$msg = $_g1[$_g];
				$_g = $_g + 1;
				$messages->push(ufront_log_ServerConsoleLogger::formatMsg($msg));
				unset($msg);
			}
		}
		if($appMessages !== null) {
			$_g2 = 0;
			while($_g2 < $appMessages->length) {
				$msg1 = $appMessages[$_g2];
				$_g2 = $_g2 + 1;
				$messages->push(ufront_log_ServerConsoleLogger::formatMsg($msg1));
				unset($msg1);
			}
		}
		ufront_log_ServerConsoleLogger::writeLog($messages->join("\x0A  "), null);
		{
			$tmp = ufront_core_SurpriseTools::success();
			$GLOBALS['%s']->pop();
			return $tmp;
		}
		$GLOBALS['%s']->pop();
	}
	static function formatMsg($m) {
		$GLOBALS['%s']->push("ufront.log.ServerConsoleLogger::formatMsg");
		$__hx__spos = $GLOBALS['%s']->length;
		$extras = null;
		$extras1 = null;
		if(_hx_field($m, "pos") !== null) {
			$extras1 = $m->pos->customParams !== null;
		} else {
			$extras1 = false;
		}
		if($extras1) {
			$extras = ", " . _hx_string_or_null($m->pos->customParams->join(", "));
		} else {
			$extras = "";
		}
		$type = _hx_substr(Type::enumConstructor($m->type), 1, null);
		$tmp = "" . _hx_string_or_null($type) . ": " . _hx_string_or_null($m->pos->className) . "." . _hx_string_or_null($m->pos->methodName) . "(" . _hx_string_rec($m->pos->lineNumber, "") . "): ";
		{
			$tmp2 = _hx_string_or_null($tmp) . Std::string($m->msg) . _hx_string_or_null($extras);
			$GLOBALS['%s']->pop();
			return $tmp2;
		}
		$GLOBALS['%s']->pop();
	}
	static function writeLog($message, $type = null) {
		$GLOBALS['%s']->push("ufront.log.ServerConsoleLogger::writeLog");
		$__hx__spos = $GLOBALS['%s']->length;
		error_log($message);
		$GLOBALS['%s']->pop();
	}
	function __toString() { return 'ufront.log.ServerConsoleLogger'; }
}
