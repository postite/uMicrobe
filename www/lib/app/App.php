<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ da28365)
 * Haxe source file: src/test/app/App.hx
 */

namespace app;

use \microbe\model\Article;
use \microbe\MicrobeInjector;
use \php\_Boot\HxException;
use \php\Boot;
use \haxe\Log;
use \sys\db\Sqlite;
use \sys\db\Transaction;
use \microbe\control\HomeController;
use \microbe\vo\FakeVo;
use \ufront\view\TemplatingEngines;
use \haxe\CallStack;
use \php\_Boot\HxAnon;
use \ufront\app\UfrontApplication;

class App {
	/**
	 * @var UfrontApplication
	 */
	static public $ufApp;


	/**
	 * @return void
	 */
	static public function inject () {
		#src/test/app/App.hx:113: lines 113-116
		$m = \Array_hx::wrap([
			Boot::getClass(Article::class),
			Boot::getClass(FakeVo::class),
		]);
		#src/test/app/App.hx:117: characters 18-72
		$result = [];
		#src/test/app/App.hx:117: characters 18-72
		$_g1 = 0;
		#src/test/app/App.hx:117: characters 18-72
		$_g = $m->length;
		#src/test/app/App.hx:117: characters 18-72
		while ($_g1 < $_g) {
			#src/test/app/App.hx:117: characters 18-72
			$_g1 = $_g1 + 1;
			#src/test/app/App.hx:117: characters 18-72
			$i = $_g1 - 1;
			#src/test/app/App.hx:117: characters 18-72
			$result[] = new HxAnon(["name" => \Type::getClassName($m->arr[$i])]);
		}

		#src/test/app/App.hx:117: characters 7-81
		$models = \Lambda::array(\Array_hx::wrap($result));
		#src/test/app/App.hx:118: characters 7-68
		App::$ufApp->injector->mapType("Array<Dynamic>", "models", null)->toValue($models);
		#src/test/app/App.hx:119: characters 8-54
		MicrobeInjector::inject(App::$ufApp->injector);
		#src/test/app/App.hx:122: characters 9-79
		App::$ufApp->injector->mapType("String", "basePath", null)->toValue("http://localhost:8888");
		#src/test/app/App.hx:142: characters 9-57
		App::$ufApp->injector->mapType("middleware.ResponseSignal", null, null)->asSingleton();
	}


	/**
	 * @return void
	 */
	static public function main () {
		#src/test/app/App.hx:38: characters 33-55
		$tmp = TemplatingEngines::get_haxe();
		#src/test/app/App.hx:31: lines 31-44
		App::$ufApp = new UfrontApplication(new HxAnon([
			"indexController" => Boot::getClass(HomeController::class),
			"remotingApi" => Boot::getClass(Apis::class),
			"logFile" => "logs/app.log",
			"templatingEngines" => \Array_hx::wrap([
				$tmp,
				TemplatingEngines::get_erazor(),
			]),
			"defaultLayout" => "microbe/microbeLayout.html",
		]));
		#src/test/app/App.hx:48: characters 9-17
		App::inject();
		#src/test/app/App.hx:52: characters 9-14
		App::run();
	}


	/**
	 * @return void
	 */
	static public function run () {
		#src/test/app/App.hx:89: lines 89-101
		try {
			#src/test/app/App.hx:91: characters 9-50
			$cnx = Sqlite::open("table.db");
			#src/test/app/App.hx:95: lines 95-98
			Transaction::main($cnx, function () {
				#src/test/app/App.hx:97: characters 12-34
				App::$ufApp->executeRequest();
			});
		} catch (\Throwable $__hx__caught_e) {
			CallStack::saveExceptionTrace($__hx__caught_e);
			$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
			$msg = $__hx__real_e;
			#src/test/app/App.hx:100: characters 9-14
			throw (is_object($__hx__throw = $msg) && $__hx__throw instanceof \Throwable ? $__hx__throw : new HxException($__hx__throw));
		}
	}


	/**
	 * @return void
	 */
	public function __construct () {
		#src/test/app/App.hx:21: characters 3-8
		(Log::$trace)("yoo", new HxAnon([
			"fileName" => "src/test/app/App.hx",
			"lineNumber" => 21,
			"className" => "app.App",
			"methodName" => "new",
		]));
	}
}


Boot::registerClass(App::class, 'app.App');
